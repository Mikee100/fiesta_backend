import { BookingStep } from './booking-message.service';
import { Queue } from 'bull';
import { EventEmitter2 } from '@nestjs/event-emitter';
import { PrismaService } from '../../prisma/prisma.service';
import { PaymentsService } from '../payments/payments.service';
import { MessagesService } from '../messages/messages.service';
import { CalendarService } from '../calendar/calendar.service';
import { NotificationsService } from '../notifications/notifications.service';
import { PackagesService } from '../packages/packages.service';
import { WhatsappService } from '../whatsapp/whatsapp.service';
import { DateTime } from 'luxon';
export declare class BookingsService {
    private prisma;
    private bookingQueue;
    private paymentsService;
    private messagesService;
    private calendarService;
    private notificationsService;
    private packagesService;
    private eventEmitter;
    private whatsappService;
    isAwaitingRescheduleTime(bookingId: string): Promise<boolean>;
    getActiveBookings(customerId: string): Promise<{
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }[]>;
    setAwaitingRescheduleSelection(customerId: string, awaiting: boolean): Promise<void>;
    setAwaitingRescheduleTime(bookingId: string, awaiting: boolean): Promise<void>;
    checkTimeConflict(dateTime: Date): Promise<boolean>;
    updateBookingTime(bookingId: string, dateTime: Date): Promise<{
        customer: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            email: string | null;
            phone: string | null;
            whatsappId: string | null;
            instagramId: string | null;
            messengerId: string | null;
            aiEnabled: boolean;
            isAiPaused: boolean;
            lastInstagramMessageAt: Date | null;
            lastMessengerMessageAt: Date | null;
            dailyTokenUsage: number;
            tokenResetDate: Date | null;
            totalTokensUsed: number;
        };
    } & {
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    private readonly logger;
    private readonly STUDIO_TZ;
    getPackages(type?: string): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        name: string;
        type: string;
        price: number;
        deposit: number;
        duration: string;
        images: number;
        makeup: boolean;
        outfits: number;
        styling: boolean;
        photobook: boolean;
        photobookSize: string | null;
        mount: boolean;
        balloonBackdrop: boolean;
        wig: boolean;
        notes: string | null;
    }[]>;
    completeBookingDraft(customerId: string, providedDateTime?: Date): Promise<{
        message: string;
        depositAmount: number;
        packageName: string;
        checkoutRequestId: string;
        paymentId: string;
    }>;
    getPackageById(id: string): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        name: string;
        type: string;
        price: number;
        deposit: number;
        duration: string;
        images: number;
        makeup: boolean;
        outfits: number;
        styling: boolean;
        photobook: boolean;
        photobookSize: string | null;
        mount: boolean;
        balloonBackdrop: boolean;
        wig: boolean;
        notes: string | null;
    }>;
    getStudioInfo(): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        notes: string;
        location: string;
    }>;
    constructor(prisma: PrismaService, bookingQueue: Queue, paymentsService: PaymentsService, messagesService: MessagesService, calendarService: CalendarService, notificationsService: NotificationsService, packagesService: PackagesService, eventEmitter: EventEmitter2, whatsappService: WhatsappService);
    private getSlotInterval;
    private intervalsOverlap;
    private formatBookingConflictMessage;
    private formatNoDateMessage;
    private formatDraftIncompleteMessage;
    getBookingDraft(customerId: string): Promise<{
        id: string;
        customerId: string;
        service: string | null;
        recipientName: string | null;
        recipientPhone: string | null;
        createdAt: Date;
        updatedAt: Date;
        name: string | null;
        date: string | null;
        time: string | null;
        dateTimeIso: string | null;
        isForSomeoneElse: boolean | null;
        step: string;
        conflictResolution: string | null;
        bookingId: string | null;
        version: number;
    }>;
    getLatestPaymentForDraft(customerId: string): Promise<{
        bookingDraft: {
            id: string;
            customerId: string;
            service: string | null;
            recipientName: string | null;
            recipientPhone: string | null;
            createdAt: Date;
            updatedAt: Date;
            name: string | null;
            date: string | null;
            time: string | null;
            dateTimeIso: string | null;
            isForSomeoneElse: boolean | null;
            step: string;
            conflictResolution: string | null;
            bookingId: string | null;
            version: number;
        };
    } & {
        id: string;
        status: string;
        createdAt: Date;
        updatedAt: Date;
        phone: string;
        bookingId: string | null;
        bookingDraftId: string | null;
        amount: number;
        mpesaReceipt: string | null;
        checkoutRequestId: string | null;
    }>;
    checkReceiptVerificationRateLimit(customerId: string): Promise<{
        allowed: boolean;
        attempts: number;
        resetTime?: Date;
    }>;
    hasRecentPaymentPrompt(customerId: string): Promise<boolean>;
    verifyPaymentByReceipt(customerId: string, receiptNumber: string): Promise<{
        success: boolean;
        message: string;
        payment?: any;
    }>;
    resendPaymentPrompt(customerId: string, newPhone?: string): Promise<{
        success: boolean;
        message: string;
    }>;
    getDepositForDraft(customerId: string): Promise<number>;
    createBookingDraft(customerId: string): Promise<{
        id: string;
        customerId: string;
        service: string | null;
        recipientName: string | null;
        recipientPhone: string | null;
        createdAt: Date;
        updatedAt: Date;
        name: string | null;
        date: string | null;
        time: string | null;
        dateTimeIso: string | null;
        isForSomeoneElse: boolean | null;
        step: string;
        conflictResolution: string | null;
        bookingId: string | null;
        version: number;
    }>;
    updateBookingDraft(customerId: string, updates: Partial<any>): Promise<{
        id: string;
        customerId: string;
        service: string | null;
        recipientName: string | null;
        recipientPhone: string | null;
        createdAt: Date;
        updatedAt: Date;
        name: string | null;
        date: string | null;
        time: string | null;
        dateTimeIso: string | null;
        isForSomeoneElse: boolean | null;
        step: string;
        conflictResolution: string | null;
        bookingId: string | null;
        version: number;
    }>;
    deleteBookingDraft(customerId: string): Promise<import(".prisma/client").Prisma.BatchPayload>;
    createBooking(customerId: string, opts: {
        message?: string;
        dateTime?: Date;
        service?: string;
        customerName?: string;
        recipientName?: string;
        recipientPhone?: string;
    }): Promise<{
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    createBookingFromMessage(message: any): Promise<{
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    checkAvailability(requested: Date, service?: string): Promise<{
        available: boolean;
        suggestions?: string[];
        sameDayFull?: boolean;
    }>;
    findAvailableSlotsAcrossDays(requestedDate: Date, service?: string, daysToCheck?: number): Promise<{
        date: string;
        slots: string[];
    }[]>;
    getAvailableSlotsForDate(date: string, service?: string): Promise<string[]>;
    updateBooking(bookingId: string, updates: {
        service?: string;
        dateTime?: Date;
    }): Promise<{
        customer: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            email: string | null;
            phone: string | null;
            whatsappId: string | null;
            instagramId: string | null;
            messengerId: string | null;
            aiEnabled: boolean;
            isAiPaused: boolean;
            lastInstagramMessageAt: Date | null;
            lastMessengerMessageAt: Date | null;
            dailyTokenUsage: number;
            tokenResetDate: Date | null;
            totalTokensUsed: number;
        };
    } & {
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    confirmBooking(bookingId: string): Promise<{
        customer: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            email: string | null;
            phone: string | null;
            whatsappId: string | null;
            instagramId: string | null;
            messengerId: string | null;
            aiEnabled: boolean;
            isAiPaused: boolean;
            lastInstagramMessageAt: Date | null;
            lastMessengerMessageAt: Date | null;
            dailyTokenUsage: number;
            tokenResetDate: Date | null;
            totalTokensUsed: number;
        };
    } & {
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    cancelBooking(bookingId: string): Promise<{
        customer: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            email: string | null;
            phone: string | null;
            whatsappId: string | null;
            instagramId: string | null;
            messengerId: string | null;
            aiEnabled: boolean;
            isAiPaused: boolean;
            lastInstagramMessageAt: Date | null;
            lastMessengerMessageAt: Date | null;
            dailyTokenUsage: number;
            tokenResetDate: Date | null;
            totalTokensUsed: number;
        };
    } & {
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    getBookings(customerId?: string): Promise<{
        bookings: ({
            customer: {
                id: string;
                createdAt: Date;
                updatedAt: Date;
                name: string;
                email: string | null;
                phone: string | null;
                whatsappId: string | null;
                instagramId: string | null;
                messengerId: string | null;
                aiEnabled: boolean;
                isAiPaused: boolean;
                lastInstagramMessageAt: Date | null;
                lastMessengerMessageAt: Date | null;
                dailyTokenUsage: number;
                tokenResetDate: Date | null;
                totalTokensUsed: number;
            };
        } & {
            id: string;
            customerId: string;
            service: string;
            dateTime: Date;
            status: string;
            durationMinutes: number | null;
            recipientName: string | null;
            recipientPhone: string | null;
            googleEventId: string | null;
            createdAt: Date;
            updatedAt: Date;
        })[];
        total: number;
    }>;
    getBookingById(id: string): Promise<{
        customer: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            email: string | null;
            phone: string | null;
            whatsappId: string | null;
            instagramId: string | null;
            messengerId: string | null;
            aiEnabled: boolean;
            isAiPaused: boolean;
            lastInstagramMessageAt: Date | null;
            lastMessengerMessageAt: Date | null;
            dailyTokenUsage: number;
            tokenResetDate: Date | null;
            totalTokensUsed: number;
        };
        invoice: {
            id: string;
            customerId: string;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            bookingId: string;
            invoiceNumber: string;
            subtotal: number;
            tax: number;
            discount: number;
            total: number;
            depositPaid: number;
            balanceDue: number;
            sentAt: Date | null;
            paidAt: Date | null;
            pdfData: Buffer | null;
            pdfUrl: string | null;
        };
        payments: {
            id: string;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string;
            bookingId: string | null;
            bookingDraftId: string | null;
            amount: number;
            mpesaReceipt: string | null;
            checkoutRequestId: string | null;
        }[];
        followups: {
            id: string;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            type: string;
            bookingId: string;
            sentAt: Date | null;
            scheduledFor: Date;
            messageContent: string | null;
            metadata: import("@prisma/client/runtime/library").JsonValue | null;
        }[];
        reminders: {
            id: string;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            type: string;
            bookingId: string;
            sentAt: Date | null;
            scheduledFor: Date;
            messageContent: string | null;
        }[];
    } & {
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    createPackage(data: any): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        name: string;
        type: string;
        price: number;
        deposit: number;
        duration: string;
        images: number;
        makeup: boolean;
        outfits: number;
        styling: boolean;
        photobook: boolean;
        photobookSize: string | null;
        mount: boolean;
        balloonBackdrop: boolean;
        wig: boolean;
        notes: string | null;
    }>;
    updatePackage(id: string, data: any): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        name: string;
        type: string;
        price: number;
        deposit: number;
        duration: string;
        images: number;
        makeup: boolean;
        outfits: number;
        styling: boolean;
        photobook: boolean;
        photobookSize: string | null;
        mount: boolean;
        balloonBackdrop: boolean;
        wig: boolean;
        notes: string | null;
    }>;
    deletePackage(id: string): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        name: string;
        type: string;
        price: number;
        deposit: number;
        duration: string;
        images: number;
        makeup: boolean;
        outfits: number;
        styling: boolean;
        photobook: boolean;
        photobookSize: string | null;
        mount: boolean;
        balloonBackdrop: boolean;
        wig: boolean;
        notes: string | null;
    }>;
    getLatestConfirmedBooking(customerId: string): Promise<{
        customer: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            email: string | null;
            phone: string | null;
            whatsappId: string | null;
            instagramId: string | null;
            messengerId: string | null;
            aiEnabled: boolean;
            isAiPaused: boolean;
            lastInstagramMessageAt: Date | null;
            lastMessengerMessageAt: Date | null;
            dailyTokenUsage: number;
            tokenResetDate: Date | null;
            totalTokensUsed: number;
        };
    } & {
        id: string;
        customerId: string;
        service: string;
        dateTime: Date;
        status: string;
        durationMinutes: number | null;
        recipientName: string | null;
        recipientPhone: string | null;
        googleEventId: string | null;
        createdAt: Date;
        updatedAt: Date;
    }>;
    formatBookingConfirmationMessage(booking: any, mpesaReceipt: string, reminderTimes?: Array<{
        days: number;
        dateTime: DateTime;
    }>): Promise<string>;
    countBookingsForCustomer(query: {
        id?: string;
        whatsappId?: string;
        phone?: string;
    }): Promise<number>;
    getBookingSummariesForCustomer(query: {
        id?: string;
        whatsappId?: string;
        phone?: string;
    }): Promise<Array<{
        date: string;
        service: string;
        status: string;
    }>>;
    private static parseDurationToMinutes;
    advanceBookingStep(customerId: string, nextStep: BookingStep): Promise<{
        id: string;
        customerId: string;
        service: string | null;
        recipientName: string | null;
        recipientPhone: string | null;
        createdAt: Date;
        updatedAt: Date;
        name: string | null;
        date: string | null;
        time: string | null;
        dateTimeIso: string | null;
        isForSomeoneElse: boolean | null;
        step: string;
        conflictResolution: string | null;
        bookingId: string | null;
        version: number;
    }>;
    getBookingStep(customerId: string): Promise<BookingStep>;
    editBookingDraft(customerId: string, field: string, value: any): Promise<{
        id: string;
        customerId: string;
        service: string | null;
        recipientName: string | null;
        recipientPhone: string | null;
        createdAt: Date;
        updatedAt: Date;
        name: string | null;
        date: string | null;
        time: string | null;
        dateTimeIso: string | null;
        isForSomeoneElse: boolean | null;
        step: string;
        conflictResolution: string | null;
        bookingId: string | null;
        version: number;
    }>;
    reviewBookingDraft(customerId: string): Promise<{
        id: string;
        customerId: string;
        service: string | null;
        recipientName: string | null;
        recipientPhone: string | null;
        createdAt: Date;
        updatedAt: Date;
        name: string | null;
        date: string | null;
        time: string | null;
        dateTimeIso: string | null;
        isForSomeoneElse: boolean | null;
        step: string;
        conflictResolution: string | null;
        bookingId: string | null;
        version: number;
    }>;
    confirmBookingDraft(customerId: string): Promise<{
        id: string;
        customerId: string;
        service: string | null;
        recipientName: string | null;
        recipientPhone: string | null;
        createdAt: Date;
        updatedAt: Date;
        name: string | null;
        date: string | null;
        time: string | null;
        dateTimeIso: string | null;
        isForSomeoneElse: boolean | null;
        step: string;
        conflictResolution: string | null;
        bookingId: string | null;
        version: number;
    }>;
    cancelBookingDraft(customerId: string): Promise<boolean>;
    handleEditCommand(customerId: string, command: string, value: string): Promise<string>;
    getBookingSummary(customerId: string): Promise<string>;
}
